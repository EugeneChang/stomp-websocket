// Generated by CoffeeScript 1.12.7
/*
   Stomp Over WebSocket http://www.jmesnil.net/stomp-websocket/doc/ | Apache License V2.0

   Copyright (C) 2010-2013 [Jeff Mesnil](http://jmesnil.net/)
   Copyright (C) 2012 [FuseSource, Inc.](http://fusesource.com)
   Copyright (C) 2017 [Deepak Kumar](https://www.kreatio.com)
 */
(function(){var _,i,b,m,u,f={}.hasOwnProperty,s=[].slice;u=require("zlib");_={LF:"\n",NULL:"\0"};b=function(){var c;function S(e,t,n,i){this.command=e;this.headers=t!=null?t:{};this.body=n!=null?n:"";this.escapeHeaderValues=i!=null?i:false}S.prototype.toString=function(){var e,t,n,i,r;e=[this.command];i=this.headers["content-length"]===false?true:false;if(i){delete this.headers["content-length"]}n=this.headers;for(t in n){if(!f.call(n,t))continue;r=n[t];if(this.escapeHeaderValues&&this.command!=="CONNECT"&&this.command!=="CONNECTED"){e.push(t+":"+S.frEscape(r))}else{e.push(t+":"+r)}}if(this.body&&!i){e.push("content-length:"+S.sizeOfUTF8(this.body))}e.push(_.LF+this.body);return e.join(_.LF)};S.sizeOfUTF8=function(e){if(e){return encodeURI(e).match(/%..|./g).length}else{return 0}};c=function(e,t){var n,i,r,s,o,c,a,u,f,l,h,p,d,g,b,m,y,v;if(t==null){t=false}s=e.search(RegExp(""+_.LF+_.LF));o=e.substring(0,s).split(_.LF);r=o.shift();c={};v=function(e){return e.replace(/^\s+|\s+$/g,"")};g=o.reverse();for(f=0,p=g.length;f<p;f++){d=g[f];u=d.indexOf(":");if(t&&r!=="CONNECT"&&r!=="CONNECTED"){c[v(d.substring(0,u))]=S.frUnEscape(v(d.substring(u+1)))}else{c[v(d.substring(0,u))]=v(d.substring(u+1))}}n="";y=s+2;if(c["content-length"]){h=parseInt(c["content-length"]);n=(""+e).substring(y,y+h)}else{i=null;for(a=l=b=y,m=e.length;b<=m?l<m:l>m;a=b<=m?++l:--l){i=e.charAt(a);if(i===_.NULL){break}n+=i}}return new S(r,c,n,t)};S.unmarshall=function(e,r){var s,o,t,n;if(r==null){r=false}o=e.split(RegExp(""+_.NULL+_.LF+"*"));n={frames:[],partial:""};n.frames=function(){var e,t,n,i;n=o.slice(0,-1);i=[];for(e=0,t=n.length;e<t;e++){s=n[e];i.push(c(s,r))}return i}();t=o.slice(-1)[0];if(t===_.LF||t.search(RegExp(""+_.NULL+_.LF+"*$"))!==-1){n.frames.push(c(t,r))}else{n.partial=t}return n};S.marshall=function(e,t,n,i){var r;r=new S(e,t,n,i);return r.toString()+_.NULL};S.frEscape=function(e){return(""+e).replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")};S.frUnEscape=function(e){return(""+e).replace(/\\r/g,"\r").replace(/\\n/g,"\n").replace(/\\c/g,":").replace(/\\\\/g,"\\")};return S}();i=function(){var g;function e(t){this.ws_fn=function(){var e;e=t();e.binaryType="arraybuffer";return e};this.reconnect_delay=0;this.counter=0;this.connected=false;this.heartbeat={outgoing:1e4,incoming:1e4};this.maxWebSocketFrameSize=16*1024;this.subscriptions={};this.partialData=""}e.prototype.debug=function(e){var t;return typeof window!=="undefined"&&window!==null?(t=window.console)!=null?t.log(e):void 0:void 0};g=function(){if(Date.now){return Date.now()}else{return(new Date).valueOf}};e.prototype._transmit=function(e,t,n){var i;i=b.marshall(e,t,n,this.escapeHeaderValues);if(typeof this.debug==="function"){this.debug(">>> "+i)}while(true){if(i.length>this.maxWebSocketFrameSize){this.ws.send(i.substring(0,this.maxWebSocketFrameSize));i=i.substring(this.maxWebSocketFrameSize);if(typeof this.debug==="function"){this.debug("remaining = "+i.length)}}else{return this.ws.send(i)}}};e.prototype._setupHeartbeat=function(r){var e,t,n,i,s,o;if((e=r.version)!==m.VERSIONS.V1_1&&e!==m.VERSIONS.V1_2){return}t=function(){var e,t,n,i;n=r["heart-beat"].split(",");i=[];for(e=0,t=n.length;e<t;e++){o=n[e];i.push(parseInt(o))}return i}(),i=t[0],n=t[1];if(!(this.heartbeat.outgoing===0||n===0)){s=Math.max(this.heartbeat.outgoing,n);if(typeof this.debug==="function"){this.debug("send PING every "+s+"ms")}this.pinger=m.setInterval(s,function(e){return function(){e.ws.send(_.LF);return typeof e.debug==="function"?e.debug(">>> PING"):void 0}}(this))}if(!(this.heartbeat.incoming===0||i===0)){s=Math.max(this.heartbeat.incoming,i);if(typeof this.debug==="function"){this.debug("check PONG every "+s+"ms")}return this.ponger=m.setInterval(s,function(t){return function(){var e;e=g()-t.serverActivity;if(e>s*2){if(typeof t.debug==="function"){t.debug("did not receive server activity for the last "+e+"ms")}return t.ws.close()}}}(this))}};e.prototype._parseConnect=function(){var e,t,n,i,r;e=1<=arguments.length?s.call(arguments,0):[];r={};if(e.length<2){throw"Connect requires at least 2 arguments"}if(typeof e[1]==="function"){r=e[0],n=e[1],i=e[2],t=e[3]}else{switch(e.length){case 6:r.login=e[0],r.passcode=e[1],n=e[2],i=e[3],t=e[4],r.host=e[5];break;default:r.login=e[0],r.passcode=e[1],n=e[2],i=e[3],t=e[4]}}return[r,n,i,t]};e.prototype.connect=function(){var e,t;e=1<=arguments.length?s.call(arguments,0):[];this.escapeHeaderValues=false;t=this._parseConnect.apply(this,e);this.headers=t[0],this.connectCallback=t[1],this.errorCallback=t[2],this.closeEventCallback=t[3];this._active=true;return this._connect()};e.prototype._connect=function(){var p,i,d,t;t=this.headers;d=this.errorCallback;i=this.closeEventCallback;if(!this._active){this.debug("Client has been marked inactive, will not attempt to connect");return}if(typeof this.debug==="function"){this.debug("Opening Web Socket...")}this.ws=this.ws_fn();p=function(e){return function(e){var t,n,i,r,s,o;o="";s=e.length;r=0;while(r<s){t=e[r++];switch(t>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(t);break;case 12:case 13:n=e[r++];o+=String.fromCharCode((t&31)<<6|n&63);break;case 14:n=e[r++];i=e[r++];o+=String.fromCharCode((t&15)<<12|(n&63)<<6|(i&63)<<0)}}return o}}(this);this.ws.onmessage=function(h){return function(e){var t,n,i,r,s,o,c,a,u,f,l;i=typeof ArrayBuffer!=="undefined"&&e.data instanceof ArrayBuffer?(t=new Uint8Array(e.data),typeof h.debug==="function"?h.debug("--- got data length: "+t.length):void 0,p(t)):e.data;h.serverActivity=g();if(i===_.LF){if(typeof h.debug==="function"){h.debug("<<< PONG")}return}if(typeof h.debug==="function"){h.debug("<<< "+i)}l=b.unmarshall(h.partialData+i,h.escapeHeaderValues);h.partialData=l.partial;u=l.frames;for(s=0,o=u.length;s<o;s++){r=u[s];switch(r.command){case"CONNECTED":if(typeof h.debug==="function"){h.debug("connected to server "+r.headers.server)}h.connected=true;h.version=r.headers.version;if(h.version===m.VERSIONS.V1_2){h.escapeHeaderValues=true}if(!h._active){h.disconnect();return}h._setupHeartbeat(r.headers);if(typeof h.connectCallback==="function"){h.connectCallback(r)}break;case"MESSAGE":f=r.headers.subscription;a=h.subscriptions[f]||h.onreceive;if(a){n=h;if(h.version===m.VERSIONS.V1_2){c=r.headers["ack"]}else{c=r.headers["message-id"]}r.ack=function(e){if(e==null){e={}}return n.ack(c,f,e)};r.nack=function(e){if(e==null){e={}}return n.nack(c,f,e)};a(r)}else{if(typeof h.debug==="function"){h.debug("Unhandled received MESSAGE: "+r)}}break;case"RECEIPT":if(r.headers["receipt-id"]===h.closeReceipt){h.ws.onclose=null;h.ws.close();h._cleanUp();if(typeof h._disconnectCallback==="function"){h._disconnectCallback()}}else{if(typeof h.onreceipt==="function"){h.onreceipt(r)}}break;case"ERROR":if(typeof d==="function"){d(r)}break;default:if(typeof h.debug==="function"){h.debug("Unhandled frame: "+r)}}}}}(this);this.ws.onclose=function(n){return function(e){var t;t="Whoops! Lost connection to "+n.ws.url;if(typeof n.debug==="function"){n.debug(t)}if(typeof i==="function"){i(e)}n._cleanUp();if(typeof d==="function"){d(t)}return n._schedule_reconnect()}}(this);return this.ws.onopen=function(e){return function(){if(typeof e.debug==="function"){e.debug("Web Socket Opened...")}t["accept-version"]=m.VERSIONS.supportedVersions();t["heart-beat"]=[e.heartbeat.outgoing,e.heartbeat.incoming].join(",");return e._transmit("CONNECT",t)}}(this)};e.prototype._schedule_reconnect=function(){if(this.reconnect_delay>0){if(typeof this.debug==="function"){this.debug("STOMP: scheduling reconnection in "+this.reconnect_delay+"ms")}return this._reconnector=setTimeout(function(e){return function(){if(e.connected){return typeof e.debug==="function"?e.debug("STOMP: already connected"):void 0}else{if(typeof e.debug==="function"){e.debug("STOMP: attempting to reconnect")}return e._connect()}}}(this),this.reconnect_delay)}};e.prototype.disconnect=function(e,t){var n;if(t==null){t={}}this._disconnectCallback=e;this._active=false;if(this.connected){if(!t.receipt){t.receipt="close-"+this.counter++}this.closeReceipt=t.receipt;try{return this._transmit("DISCONNECT",t)}catch(e){n=e;return typeof this.debug==="function"?this.debug("Ignoring error during disconnect",n):void 0}}};e.prototype._cleanUp=function(){if(this._reconnector){clearTimeout(this._reconnector)}this.connected=false;this.subscriptions={};this.partial="";if(this.pinger){m.clearInterval(this.pinger)}if(this.ponger){return m.clearInterval(this.ponger)}};e.prototype.send=function(e,t,n){if(t==null){t={}}if(n==null){n=""}t.destination=e;return this._transmit("SEND",t,n)};e.prototype.gzipSend=function(e,t,n){var i,r,s,o,c,a;if(t==null){t={}}if(!n){return}r=["SEND"];r.push("destination:"+e);r.push("compression:gzip");r.push("content-type:application/gzip");o=this.headers;for(s in o){if(!f.call(o,s))continue;c=o[s];if(this.escapeHeaderValues){r.push(s+":"+b.frEscape(c))}else{r.push(s+":"+c)}}a=u.gzipSync(Buffer.from(n));r.push("content-length:"+Buffer.byteLength(a));i=[];i.push(Buffer.from(r.join(_.LF)+_.LF+_.LF));i.push(a);i.push(Buffer.from(_.NULL));return this.ws.send(new Uint8Array(Buffer.concat(i)).buffer)};e.prototype.subscribe=function(e,t,n){var i;if(n==null){n={}}if(!n.id){n.id="sub-"+this.counter++}n.destination=e;this.subscriptions[n.id]=t;this._transmit("SUBSCRIBE",n);i=this;return{id:n.id,unsubscribe:function(e){return i.unsubscribe(n.id,e)}}};e.prototype.unsubscribe=function(e,t){if(t==null){t={}}delete this.subscriptions[e];t.id=e;return this._transmit("UNSUBSCRIBE",t)};e.prototype.begin=function(e){var t,n;n=e||"tx-"+this.counter++;this._transmit("BEGIN",{transaction:n});t=this;return{id:n,commit:function(){return t.commit(n)},abort:function(){return t.abort(n)}}};e.prototype.commit=function(e){return this._transmit("COMMIT",{transaction:e})};e.prototype.abort=function(e){return this._transmit("ABORT",{transaction:e})};e.prototype.ack=function(e,t,n){if(n==null){n={}}if(this.version===m.VERSIONS.V1_2){n["id"]=e}else{n["message-id"]=e}n.subscription=t;return this._transmit("ACK",n)};e.prototype.nack=function(e,t,n){if(n==null){n={}}if(this.version===m.VERSIONS.V1_2){n["id"]=e}else{n["message-id"]=e}n.subscription=t;return this._transmit("NACK",n)};return e}();m={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.2,1.1,1.0"}},client:function(t,n){var e;if(n==null){n=["v10.stomp","v11.stomp","v12.stomp"]}e=function(){var e;e=m.WebSocketClass||WebSocket;return new e(t,n)};return new i(e)},over:function(e){var t;t=typeof e==="function"?e:function(){return e};return new i(t)},Frame:b};m.setInterval=function(e,t){return setInterval(t,e)};m.clearInterval=function(e){return clearInterval(e)};if(typeof exports!=="undefined"&&exports!==null){exports.Stomp=m}if(typeof window!=="undefined"&&window!==null){window.Stomp=m}else if(!exports){self.Stomp=m}}).call(this);